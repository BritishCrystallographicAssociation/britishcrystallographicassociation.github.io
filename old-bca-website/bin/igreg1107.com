$ WN := WRITE NET_LINK$ WN "<DNETRECMODE>"$!$! Obtain all of the parameter values from the HTML form.$ INP := $WWW_ROOT:[BIN]CGI_SYMBOLS$ INP WWW_ FORM_$!$! Check compulsory fields only on form.$ NERR = 0$!$!     *** MAKE SURE LIST BELOW MATCHES THOSE MARKED REQUIRED ON FORM ***$!$ IF "''FORM_FLD_FIRSTNAME'" .EQS. "" THEN $ NERR = NERR + 1$ IF "''FORM_FLD_SURNAME'" .EQS. "" THEN $ NERR = NERR + 1$ IF "''FORM_FLD_EMAIL'" .EQS. "" THEN $ NERR = NERR + 1$ IF "''FORM_FLD_STREET'" .EQS. "" THEN $ NERR = NERR + 1$ IF "''FORM_FLD_TOWN'" .EQS. "" THEN $ NERR = NERR + 1$ IF "''FORM_FLD_ZIP'" .EQS. "" THEN $ NERR = NERR + 1$ IF "''FORM_FLD_COUNTRY'" .EQS. "" THEN $ NERR = NERR + 1$! Check email address for non-allowed characters.$ IFIND = F$LENGTH(FORM_FLD_EMAIL) -  F$LOCATE("""",FORM_FLD_EMAIL)$ IFIND = IFIND + F$LENGTH(FORM_FLD_EMAIL) -  F$LOCATE("'",FORM_FLD_EMAIL)$ IFIND = IFIND + F$LENGTH(FORM_FLD_EMAIL) -  F$LOCATE("<",FORM_FLD_EMAIL)$ IF IFIND .NE. 0 THEN $ NERR = NERR + 1$! If error count is non-zero, give error message.$ IF NERR .NE. 0 THEN $ GOTO 20$!$!$!$!             *** CHANGE FILENAME BELOW FOR EACH COUNTER USED ***$!      (Only the stem of the filename, called MEETING, need be changed)$!$ MEETING = "IG-REG-1005"$! Define filename containing registration count.$ COUNTER = "''MEETING'.TXT"$ NEWFILE = F$SEARCH("''COUNTER'")$ IF "''NEWFILE'" .NES. "" THEN $ GOTO 5$! Create log counter with start value of zero (first time script is run).$ CREATE 'COUNTER'0$ 5:$!$! Open log counter and increment if no errors.$ OPEN/READ FILECOUNTER 'COUNTER'$ READ FILECOUNTER REGNO$ CLOSE/NOLOG FILECOUNTER$ REGNO = 'REGNO' + 1$ OPEN/WRITE FILECOUNTER 'COUNTER'$ WRITE FILECOUNTER 'REGNO'$ CLOSE/NOLOG FILECOUNTER$ PURGE/NOLOG 'COUNTER'$ RENAME 'COUNTER' 'COUNTER';1$!$!             ***  IF DATE NOT REQUIRED, CHOP NEXT SECTION ***$!$! Get date in nice format.$ TIME = F$TIME()$ DAT = F$EXTRACT(0,2,TIME)$ MON = F$EXTRACT(3,3,TIME)$ IF "''MON'" .EQS. "JAN" THEN $ MON = "January"$ IF "''MON'" .EQS. "FEB" THEN $ MON = "February"$ IF "''MON'" .EQS. "MAR" THEN $ MON = "March"$ IF "''MON'" .EQS. "APR" THEN $ MON = "April"$ IF "''MON'" .EQS. "MAY" THEN $ MON = "May"$ IF "''MON'" .EQS. "JUN" THEN $ MON = "June"$ IF "''MON'" .EQS. "JUL" THEN $ MON = "July"$ IF "''MON'" .EQS. "AUG" THEN $ MON = "August"$ IF "''MON'" .EQS. "SEP" THEN $ MON = "September"$ IF "''MON'" .EQS. "OCT" THEN $ MON = "October"$ IF "''MON'" .EQS. "NOV" THEN $ MON = "November"$ IF "''MON'" .EQS. "DEC" THEN $ MON = "December"$ YEAR = F$EXTRACT(7,4,TIME)$ TODAY = DAT + " " + MON + " " + YEAR$!$!$!                   *** NO NEED TO VARY FILENAME HERE ***$!$! Open temporary file for message.$ INFOFILE = "DKUSER3:[WWW]''MEETING'" + "''REGNO'" + ".TXT;1"$ INFOFILE := 'F$EDIT(INFOFILE,"COLLAPSE")'$ OPEN/WRITE INFO 'INFOFILE'$ WO := WRITE INFO$ WO "       NOTE: Do NOT reply to the web server email address!"$ WO ""$ WO "************************************************"$ WO "ELECTRONIC REGISTRATION FORM for BCA-IG MEETINGS 7th & 8th November 2007"$ WO ""$ WO "REGISTRATION NUMBER: # ''REGNO'"$ WO ""$ WO "Details:"$ WO ""$ WO "Title:       ''FORM_FLD_TITLE'"$ WO "First name:  ''FORM_FLD_FIRSTNAME'"$ WO "Initial(s):  ''FORM_FLD_INITIALS'"$ WO "Surname:     ''FORM_FLD_SURNAME'"$ WO "E-mail:      ''FORM_FLD_EMAIL'"$ WO ""$ WO "Postal address:"$ WO ""$ WO "Department:          ''FORM_FLD_DEPART'"$ WO "Institution:         ''FORM_FLD_INSTITUTE'"$ WO "Address (building):  ''FORM_FLD_BUILDING'"$ WO "Address (street):    ''FORM_FLD_STREET'"$ WO "Address (town):      ''FORM_FLD_TOWN'"$ WO "Address (county):    ''FORM_FLD_COUNTY'"$ WO "Address (post code): ''FORM_FLD_ZIP'"$ WO "Address (country):   ''FORM_FLD_COUNTRY'"$ WO ""$ WO "Telephone:           ''FORM_FLD_PHONE'"$ WO "Facsimile:           ''FORM_FLD_FAX'"$ WO ""$ WO "Special requests:"$ REQ1 = "''F$EXTRACT(0,80,FORM_FLD_COMMENTS)'"$ REQ2 = "''F$EXTRACT(80,80,FORM_FLD_COMMENTS)'"$ REQ3 = "''F$EXTRACT(160,80,FORM_FLD_COMMENTS)'"$ WO "''REQ1'"$ WO "''REQ2'"$ WO "''REQ3'"$ WO ""$ IF "''FORM_FLD_DLIST'" .NES. "" THEN $ WO "You have agreed to be included in the Delegate List."$ IF "''FORM_FLD_DLIST'" .EQS. "" THEN $ WO "You will NOT be included in the Delegate List."$ WO ""$ WO "You have registered to attend on:       ''FORM_FLD_DAYS' November 2007"$ WO ""$ FEES = "0"$ IF "''FORM_FLD_MEMCONC'" .EQS. "full" .AND. "''FORM_FLD_DAYS'" .EQS. "7" THEN $ FEES := "50"$ IF "''FORM_FLD_MEMCONC'" .EQS. "full" .AND. "''FORM_FLD_DAYS'" .EQS. "8" THEN $ FEES := "40"$ IF "''FORM_FLD_MEMCONC'" .EQS. "full" .AND. "''FORM_FLD_DAYS'" .EQS. "7-8" THEN $ FEES := "90"$ IF "''FORM_FLD_MEMCONC'" .NES. "full" .AND. "''FORM_FLD_DAYS'" .EQS. "7" THEN $ FEES := "20"$ IF "''FORM_FLD_MEMCONC'" .NES. "full" .AND. "''FORM_FLD_DAYS'" .EQS. "8" THEN $ FEES := "20"$ IF "''FORM_FLD_MEMCONC'" .NES. "full" .AND. "''FORM_FLD_DAYS'" .EQS. "7-8" THEN $ FEES := "40"$ IF "''FORM_FLD_NMFEE'" .EQS. "20" .AND. "''FEES'" .EQS. 40 THEN $ FEES := "60"$ IF "''FORM_FLD_NMFEE'" .EQS. "20" .AND. "''FEES'" .EQS. 20 THEN $ FEES := "40"$ IF "''FORM_FLD_NMFEE'" .EQS. "20" .AND. "''FEES'" .EQS. 50 THEN $ FEES := "70"$ IF "''FORM_FLD_NMFEE'" .EQS. "20" .AND. "''FEES'" .EQS. 90 THEN $ FEES := "110"$ WO "Registration Fee:  ''FEES'"$ WO ""$ IF "''FORM_FLD_MEMCONC'" .EQS. "full" THEN $ WO "Concessions: none"$ IF "''FORM_FLD_MEMCONC'" .NES. "full" THEN $ WO "Concessions: ''FORM_FLD_MEMCONC'"$ IF "''FORM_FLD_MEMCONC'" .NES. "student" THEN $ GOTO 10$ WO "Supervisors Name: ''FORM_FLD_SVISORENAME'"$ WO "Supervisors E-mail: ''FORM_FLD_SVISOREMAIL'"$ 10:$ WO ""$ IF "''FORM_FLD_NMFEE'" .EQS. "0" THEN $ WO "Membership: Current BCA member"$ IF "''FORM_FLD_NMFEE'" .EQS. "0" THEN $ GOTO 15$ IF "''FORM_FLD_DECLINE'" .NES. "" THEN $ WO "Membership: Non member declines offers to join BCA"$ IF "''FORM_FLD_DECLINE'" .NES. "" THEN $ GOTO 15$ IF "''FORM_FLD_MEMTYPE'" .NES. "" THEN $ WO "Membership: Please enrol member as: ''FORM_FLD_MEMTYPE'"$ IF "''FORM_FLD_MAIN'" .NES. "" THEN $ WO "Main interest: ''FORM_FLD_MAIN'"$ IF "''FORM_FLD_SIND'" .NES. "" THEN $ FORM_FLD_SIND := "IG"$ IF "''FORM_FLD_SBSG'" .NES. "" THEN $ FORM_FLD_SBSG := "BSG"$ IF "''FORM_FLD_SCCG'" .NES. "" THEN $ FORM_FLD_SCCG := "CCG"$ IF "''FORM_FLD_SPCG'" .NES. "" THEN $ FORM_FLD_SPCG := "PCG"$ SPEC := "''FORM_FLD_SIND' ''FORM_FLD_SBSG' ''FORM_FLD_SCCG' ''FORM_FLD_SPCG'"$ ALLSPEC := 'F$EDIT(SPEC,"COLLAPSE")'$ IF "''ALLSPEC'" .NES. "" THEN $ WO "Special interest: ''SPEC'"$ 15:$ WO ""$ WO "       END OF ELECTRONIC REGISTRATION FORM      "$ WO "************************************************"$ WO ""$ WO "       NOTE: Do NOT reply to the web server email address!"$ WO ""$! Close temporary file.$ CLOSE/NOLOG INFO$!$!$!                   *** NO NEED TO VARY FILENAME HERE ***$!$! Generate invoice.$ INVOICE = "DKUSER3:[WWW]''MEETING'" + "''REGNO'" + ".HTM;1"$ INVOICE := 'F$EDIT(INVOICE,"COLLAPSE")'$ INITIALS = F$EXTRACT(0,1,FORM_FLD_FIRSTNAME) + FORM_FLD_INITIALS$ OPEN/WRITE BILL 'INVOICE'$ WB := WRITE BILL$ WB "<HTML>"$ WB "<HEAD>"$ WB "<TITLE>BCA-IG Registration Meeting Invoice"$ WB "</TITLE>"$ WB "</HEAD>"$ WB "<BODY BGCOLOR=#FFFFFF TEXT=#000000 ALINK=#FF0000 LINK=#0000FF VLINK=#AA00FF>"$ WB "<HR SIZE=2 NOSHADE>"$ WB "<CENTER>"$ WB "<FONT SIZE=+1 COLOR=#FF0000><B>INVOICE - Registration for BCA Industrial"$ WB "Group Meeting 7-8 November 2007</B></FONT>"$ WB "<BR>"$ WB "<IMG SRC=""http://bca.cryst.bbk.ac.uk/bca/images/iglogo.gif"" BORDER=0>"$ WB "</CENTER>"$ WB "<HR SIZE=2 NOSHADE>"$ WB "<P>"$ WB "<TABLE BORDER=0 WIDTH=100% CELLPADDING=0 CELLSPACING=0>"$ WB "<TR ALIGN=RIGHT><TD ALIGN=LEFT><I>Date</I>: ''TODAY'</TD><TD>"$ WB "''FORM_FLD_TITLE' ''INITIALS' ''FORM_FLD_SURNAME'</TD></TR>"$ WB "<TR ALIGN=RIGHT><TD COLSPAN=2>"$ IF "''FORM_FLD_DEPART'" .NES. "" THEN $ -  WB "''FORM_FLD_DEPART'</TD></TR><TR ALIGN=RIGHT><TD COLSPAN=2>"$ IF "''FORM_FLD_INSTITUTE'" .NES. "" THEN $ -  WB "''FORM_FLD_INSTITUTE'</TD></TR><TR ALIGN=RIGHT><TD COLSPAN=2>"$ IF "''FORM_FLD_BUILDING'" .NES. "" THEN $ -  WB "''FORM_FLD_BUILDING'</TD></TR><TR ALIGN=RIGHT><TD COLSPAN=2>"$ WB "''FORM_FLD_STREET'</TD></TR><TR ALIGN=RIGHT><TD COLSPAN=2>"$ WB "''FORM_FLD_TOWN'</TD></TR><TR ALIGN=RIGHT><TD COLSPAN=2>"$ IF "''FORM_FLD_COUNTY'" .NES. "" THEN $ -  WB "''FORM_FLD_COUNTY'</TD></TR><TR ALIGN=RIGHT><TD COLSPAN=2>"$ WB "''FORM_FLD_COUNTRY'</TD></TR><TR ALIGN=RIGHT><TD COLSPAN=2>"$ WB "''FORM_FLD_ZIP'</TD></TR>"$ WB "</TABLE>"$ WB "<P>"$ WB "<CENTER>"$ WB "<FONT SIZE=+2><B>Meeting Registration Number # ''REGNO' - INVOICE"$ WB "</B></FONT>"$ WB "</CENTER>"$ WB "<P>"$ WB "<P>"$ WB "Please pay <I>either</I> by BACS (a/c 00412698 at 30-19-14 Lloyds"$ WB "Bank, Birmingham, quoting your BACS reference as: ""1107''REGNO'"$ WB "''INITIALS' ''FORM_FLD_SURNAME'"")"$ WB "<I>or</I> by cheque in pounds sterling the sum of:"$ WB "<P>"$ WB "<CENTER><FONT SIZE=+2><B>&pound;"$ WB "''FEES'"$ WB "</B></FONT>"$ WB "</CENTER>"$ WB "<P>"$ WB "as registration fee for the BCA Industrial Group Meeting on"$ WB "''FORM_FLD_DAYS' November 2007 at AstraZeneca, Macclesfield. Cheques should be made"$ WB "out to the <I>BCA Industrial Group</I> and should be posted along with"$ WB "a copy of this invoice"$ WB "to the BCA-IG treasurer at the address below. Notification of BACS payment"$ WB "MUST be sent by post to the BCA treasurer together with a copy of this"$ WB "invoice and a copy of your BACS payment details."$ WB "<P>"$ WB "<CENTER><FONT SIZE=+1><B>Terms Net 7 Days</B></FONT></CENTER>"$ WB "<P><B><FONT COLOR=#FF0000>"$ WB "Please include a copy of the invoice, as proof of registration, with"$ WB "your payment. Your registration ONLY becomes valid on receipt of FULL"$ WB "PAYMENT.</FONT></B>"$ WB "<P>"$ WB "<BR>"$ WB "<BR>"$ WB "BCA-IG Treasurer/Secretary"$ WB "<BR>"$ WB "Dr David Beveridge"$ WB "<BR>"$ WB "Harman Technology (ILFORD Photo)"$ WB "<BR>"$ WB "Ilford Way, Mobberley,"$ WB "<BR>"$ WB "Knutsford, Cheshire"$ WB "<BR>"$ WB "WA16 7JL "$ WB "<BR>"$ WB "United Kingdom"$ WB "<BR>"$ WB "E-mail: david.beveridge@harmantechnology.com"$ WB "<P>"$ WB "<HR SIZE=2 NOSHADE>"$ WB "<CENTER>"$ WB "<FONT SIZE=-1>"$ WB "The BCA is an Educational Charity with Registration No. 284718"$ WB "</FONT>"$ WB "</CENTER>"$ WB "</BODY>"$ WB "</HTML>"$! Close temporary file.$ CLOSE/NOLOG BILL$!$!$!                   *** NO NEED TO VARY FILENAME HERE ***$!$! Open temporary file for name badges.$ BADGES = "DKUSER3:[WWW]''MEETING'-BADGE" + "''REGNO'" + ".TXT;1"$ BADGES := 'F$EDIT(BADGES,"COLLAPSE")'$ OPEN/WRITE BATS 'BADGES'$ WB := WRITE BATS$ WB "Person: ''FORM_FLD_TITLE' ''FORM_FLD_FIRSTNAME' ''FORM_FLD_SURNAME'"$ WB "Place: ''FORM_FLD_DEPART', ''FORM_FLD_INSTITUTE', ''FORM_FLD_TOWN'"$! Just in case clarification is required.$ WB "E-mail: ''FORM_FLD_EMAIL'"$ WB "Registered to attend on: ''FORM_FLD_DAYS' October 2005"$ WB ""$! Close temporary file.$ CLOSE/NOLOG BATS$!$!$! *** MIME SEPARATORS FILES MAY REQUIRE CUSTOMISATION - SO CHECK EACH TIME ***$!                       (In practice only MIME1.TXT)$!$! Setup attachment.$ COPY/NOLOG   DKUSER2:[PUBLIC.WWW.BCA.BIN]MIME1.TXT MAIL-'MEETING'-'REGNO'.TXT$ APPEND/NOLOG 'INFOFILE' MAIL-'MEETING'-'REGNO'.TXT$ APPEND/NOLOG DKUSER2:[PUBLIC.WWW.BCA.BIN]MIME2.TXT MAIL-'MEETING'-'REGNO'.TXT$ APPEND/NOLOG 'INVOICE'  MAIL-'MEETING'-'REGNO'.TXT$ APPEND/NOLOG DKUSER2:[PUBLIC.WWW.BCA.BIN]MIME3.TXT MAIL-'MEETING'-'REGNO'.TXT$!$! Email registration form to IG secretary (Judith).$ MAIL/SUBJECT="IG Autumn Meeting Registration ''REGNO' Details" 'INFOFILE' "david.beveridge@harmantechnology.com"$! Email registration form (COPY) to IG webmaster (Dave).$ MAIL/SUBJECT="IG Autumn Meeting Registration ''REGNO' Details (COPY)" 'INFOFILE' "djt35@btopenworld.com"$! Email badge information to Jeremy.$ MAIL/SUBJECT="IG Autumn Meeting Badge ''REGNO' Details" 'BADGES' "anne.kavanagh@astrazeneca.com"$!$! Email registration details and invoice to A.NAME as attachment.$ ON ERROR THEN $ CONTINUE$ MAIL/SUBJECT="Invoice/Registration BCA-IG Pharmaceutical SIG Meeting and/or Autumn Meeting" MAIL-'MEETING'-'REGNO'.TXT "''FORM_FLD_EMAIL'"$$! Delete scratch files.$ DELETE/NOLOG 'INFOFILE'$ DELETE/NOLOG 'INVOICE'$ DELETE/NOLOG 'BADGES'$ DELETE/NOLOG MAIL-'MEETING'-'REGNO'.TXT;1$!$! Message to browser.$ WN "content-type: text/html"$ WN ""$ WN "<HTML>"$ WN "<HEAD>"$ WN "<TITLE>Registration Form for BCA-IG Meeting 7 - 8 November 2007 Completed</TITLE>"$ WN "</HEAD>"$ WN "<BODY BGCOLOR=#FFFFFF TEXT=#000000 ALINK=#FF0000 LINK=#0000FF VLINK=#AA00FF>"$ WN "<CENTER>"$ WN "<A HREF=""/bca/ig/ig.htm""><IMG SRC=""/bca/images/iglogo.gif"" BORDER=0></A>"$ WN "<P>"$ WN "<FONT SIZE=+2><B>Your Registration Number is ''REGNO'</B></FONT>"$ WN "</CENTER>"$ WN "<P>"$ WN "Thank you for taking the time to register electronically for the BCA"$ WN "Industrial Group meeting on 7 - 8&nbsp;November&nbsp;2007."$ WN "You should receive an email version of your registration details"$ WN "in plain text format plus an email invoice in HTML format."$ WN "It is essential that you print the invoice and pay the"$ WN "registration fee within 7 days to the Industrial Group Treasurer."$ WN "<P><FONT COLOR=#FF0000><B>"$ WN "NOTE: Your registration only becomes valid on receipt of FULL PAYMENT."$ WN "</B></FONT><P>"$ WN "Click on the logo to go to the BCA-IG homepage or press your browser"$ WN "back button to return to the meeting details."$ WN "</BODY>"$ WN "</HTML>"$ EXIT$!$ 20:$ WN "content-type: text/html"$ WN ""$ WN "<HTML>"$ WN "<HEAD>"$ WN "<TITLE>Registration Form Incomplete!</TITLE>"$ WN "</HEAD>"$ WN "<BODY BGCOLOR=#FFFFFF TEXT=#000000 ALINK=#FF0000 LINK=#0000FF VLINK=#AA00FF>"$ WN "<CENTER>"$ WN "<A HREF=""/bca/welcome.htm""><IMG SRC=""/bca/images/iglogo.gif"" BORDER=0></A>"$ WN "<P><FONT SIZE=+2><B>Registration Form Incomplete!</B></FONT><P>"$ WN "Sorry, but you failed to fill in the form correctly.<P>"$ WN "Use the back button on your browser to return to the form.<P>"$ WN "Please make sure that you complete all items marked with an "$ WN "<FONT COLOR=#FF0000><B>*<B></FONT> correctly.<BR>(E-mail addesses must NOT"$ WN "contain single or double quotation marks or &lt;&gt; brackets also.)"$ WN "</CENTER>"$ WN "</BODY>"$ WN "</HTML>"$ EXIT