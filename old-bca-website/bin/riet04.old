$ WN := WRITE NET_LINK$ WN "<DNETRECMODE>"$ INP := $WWW_ROOT:[BIN]CGI_SYMBOLS$ INP WWW_ FORM_$!$ NERR = 0$! Check compulsory fields only.$ IF "''FORM_FLD_TITLE'" .EQS. "" THEN $ NERR = NERR + 1$ IF "''FORM_FLD_FIRSTNAME'" .EQS. "" THEN $ NERR = NERR + 1$ IF "''FORM_FLD_SURNAME'" .EQS. "" THEN $ NERR = NERR + 1$ IF "''FORM_FLD_BCANO'" .EQS. "" THEN $ NERR = NERR + 1$ IF "''FORM_FLD_EMAIL'" .EQS. "" THEN $ NERR = NERR + 1$ IF "''FORM_FLD_STREET'" .EQS. "" THEN $ NERR = NERR + 1$ IF "''FORM_FLD_TOWN'" .EQS. "" THEN $ NERR = NERR + 1$ IF "''FORM_FLD_COUNTRY'" .EQS. "" THEN $ NERR = NERR + 1$ IF "''FORM_FLD_ZIP'" .EQS. "" THEN $ NERR = NERR + 1$ IF "''FORM_FLD_PHONE'" .EQS. "" THEN $ NERR = NERR + 1$! Check email address for non-allowed characters.$ IFIND = F$LENGTH(FORM_FLD_EMAIL) -  F$LOCATE("""",FORM_FLD_EMAIL)$ IFIND = IFIND + F$LENGTH(FORM_FLD_EMAIL) -  F$LOCATE("'",FORM_FLD_EMAIL)$ IF IFIND .NE. 0 THEN $ NERR = NERR + 1$! If error count is non-zero, give error message.$ IF NERR .NE. 0 THEN $ GOTO 20$!$! Open log counter and increment if no errors.$ OPEN/READ ICOUNT RIET-NO.TXT$ READ ICOUNT REGNO$ CLOSE/NOLOG ICOUNT$ REGNO = 'REGNO' + 1$ OPEN/WRITE ICOUNT RIET-NO.TXT$ WRITE ICOUNT 'REGNO'$ CLOSE/NOLOG ICOUNT$ PURGE/NOLOG RIET-NO.TXT$ RENAME RIET-NO.TXT RIET-NO.TXT;1$!$! Open temporary file for message.$ INFOFILE = "DKUSER3:[WWW]REG" + "''REGNO'" + ".TXT;1"$ INFOFILE := 'F$EDIT(INFOFILE,"COLLAPSE")'$ OPEN/WRITE INFO 'INFOFILE'$ WO := WRITE INFO$ WO "       NOTE: Do NOT reply to the web server email address!"$ WO ""$ WO "************************************************"$ WO "ELECTRONIC REGISTRATION FORM for RIETVELD WORKSHOP II"$ WO ""$ WO "REGISTRATION NUMBER: # ''REGNO'"$ WO ""$ WO "Details:"$ WO ""$ WO "Title:       ''FORM_FLD_TITLE'"$ WO "First name:  ''FORM_FLD_FIRSTNAME'"$ WO "Initial(s):  ''FORM_FLD_INITIALS'"$ WO "Surname:     ''FORM_FLD_SURNAME'"$ WO "BCA No.:     ''FORM_FLD_BCANO'"$ WO "E-mail:      ''FORM_FLD_EMAIL'"$ WO ""$ WO "Postal address:"$ WO ""$ WO "Department:          ''FORM_FLD_DEPARTMENT'"$ WO "Institution:         ''FORM_FLD_INSTITUTE'"$ WO "Address (building):  ''FORM_FLD_BUILDING'"$ WO "Address (street):    ''FORM_FLD_STREET'"$ WO "Address (town):      ''FORM_FLD_TOWN'"$ WO "Address (county):    ''FORM_FLD_COUNTY'"$ WO "Address (country):   ''FORM_FLD_COUNTRY'"$ WO "Address (post code): ''FORM_FLD_ZIP'"$ WO ""$ WO "Telephone:           ''FORM_FLD_PHONE'"$ WO ""$ WO "Special requests:"$ REQ1 := 'F$EXTRACT(0,80,FORM_FLD_COMMENTS)'$ REQ2 := 'F$EXTRACT(80,80,FORM_FLD_COMMENTS)'$ REQ3 := 'F$EXTRACT(160,80,FORM_FLD_COMMENTS)'$ WO "''REQ1'"$ WO "''REQ2'"$ WO "''REQ3'"$ WO ""$ FEES = FORM_FLD_FEES$ IF "''FEES'" .NES. 50 THEN $ FEES := "0"$ WO "Registration Fee:  ''FEES'"$ WO ""$ WO "Supervisors Name: ''FORM_FLD_SUPERVISOR'"$ WO "Supervisors E-mail: ''FORM_FLD_SUPEREMAIL'"$ WO ""$ WO "       END OF ELECTRONIC REGISTRATION FORM      "$ WO "************************************************"$ WO ""$ WO "       NOTE: Do NOT reply to the web server email address!"$ WO ""$! Close temporary file.$ CLOSE/NOLOG INFO$!$! Email registration form to PCG secretary (John) and JKC.$ MAIL/SUBJECT="Rietveld Workshop Registration" 'INFOFILE' "john.evans@durham.ac.uk"$ MAIL/SUBJECT="Rietveld Workshop Registration" 'INFOFILE' "cockcroft@img.cryst.bbk.ac.uk"$!$! Delete scratch files.$ DELETE/NOLOG 'INFOFILE'$!$! Message to browser.$ WN "content-type: text/html"$ WN ""$ WN "<HTML>"$ WN "<HEAD>"$ WN "<TITLE>Registration Form for Rietveld Course Received OK</TITLE>"$ WN "</HEAD>"$ WN "<BODY BGCOLOR=#FFFFFF TEXT=#000000 ALINK=#FF0000 LINK=#0000FF VLINK=#AA00FF>"$ WN "<CENTER>"$ WN "<A HREF=""/bca/welcome.htm""><IMG SRC=""/bca/images/bcalogo2.gif"" BORDER=0></A>"$ WN "<P>"$ WN "<FONT SIZE=+2><B>Your Registration Number is ''REGNO'</B></FONT>"$ WN "</CENTER>"$ WN "</BODY>"$ WN "</HTML>"$ EXIT$!$ 20:$ WN "content-type: text/html"$ WN ""$ WN "<HTML>"$ WN "<HEAD>"$ WN "<TITLE>Registration Form Incomplete!</TITLE>"$ WN "</HEAD>"$ WN "<BODY BGCOLOR=#FFFFFF TEXT=#000000 ALINK=#FF0000 LINK=#0000FF VLINK=#AA00FF>"$ WN "<CENTER>"$ WN "<A HREF=""/bca/welcome.htm""><IMG SRC=""/bca/images/bcalogo2.gif"" BORDER=0></A>"$ WN "<P><FONT SIZE=+2><B>Registration Form Incomplete!</B></FONT><P>"$ WN "Sorry, but you failed to fill in the form correctly.<P>"$ WN "Use the back button on your browser to return to the form.<P>"$ WN "Please make sure that you complete all items marked with an "$ WN "<FONT COLOR=#FF0000><B>*<B></FONT> correctly.<BR>(E-mail addesses must NOT"$ WN "contain single or double quotation marks, also no angle brackets!)"$ WN "</CENTER>"$ WN "</BODY>"$ WN "</HTML>"$ EXIT