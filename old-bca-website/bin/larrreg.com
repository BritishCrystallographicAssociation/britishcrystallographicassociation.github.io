$ WN := WRITE NET_LINK$ WN "<DNETRECMODE>"$!$! Obtain all of the parameter values from the HTML form.$ INP := $WWW_ROOT:[BIN]CGI_SYMBOLS$ INP WWW_ FORM_$!$!$! Check compulsory fields only on form.$ NERR = 0$!$!     *** MAKE SURE LIST BELOW MATCHES THOSE MARKED REQUIRED ON FORM ***$!$ IF "''FORM_FLD_TITLE'" .EQS. "" THEN $ NERR = NERR + 1$ IF "''FORM_FLD_FIRSTNAME'" .EQS. "" THEN $ NERR = NERR + 1$ IF "''FORM_FLD_SURNAME'" .EQS. "" THEN $ NERR = NERR + 1$ IF "''FORM_FLD_EMAIL'" .EQS. "" THEN $ NERR = NERR + 1$ IF "''FORM_FLD_PHONE'" .EQS. "" THEN $ NERR = NERR + 1$ IF "''FORM_FLD_STREET'" .EQS. "" THEN $ NERR = NERR + 1$ IF "''FORM_FLD_TOWN'" .EQS. "" THEN $ NERR = NERR + 1$ IF "''FORM_FLD_ZIP'" .EQS. "" THEN $ NERR = NERR + 1$! Check email address for non-allowed characters.$ IFIND = F$LENGTH(FORM_FLD_EMAIL) -  F$LOCATE("""",FORM_FLD_EMAIL)$ IFIND = IFIND + F$LENGTH(FORM_FLD_EMAIL) -  F$LOCATE("'",FORM_FLD_EMAIL)$ IF IFIND .NE. 0 THEN $ NERR = NERR + 1$! If error count is non-zero, give error message.$ IF NERR .NE. 0 THEN $ GOTO 20$!$!$!           *** JUST CHANGE FILENAME BELOW FOR EACH COUNTER USED ***$!           ***    (JKC can reset counter to zero if required)   ***$!$! Define filename containing registration count.$ COUNTER = "IG-REG-RR2.TXT"$! If counter does not exist, create file.$ NEWFILE = F$SEARCH("''COUNTER'")$ IF "''NEWFILE'" .NES. "" THEN $ GOTO 5$! Create log counter with start value of zero (first time script is run).$ CREATE 'COUNTER'0$ 5:$! Open log counter and increment if no errors.$ OPEN/READ FILECOUNTER 'COUNTER'$ READ FILECOUNTER REGNO$ CLOSE/NOLOG FILECOUNTER$ REGNO = 'REGNO' + 1$ OPEN/WRITE FILECOUNTER 'COUNTER'$ WRITE FILECOUNTER 'REGNO'$ CLOSE/NOLOG FILECOUNTER$ PURGE/NOLOG 'COUNTER'$ RENAME 'COUNTER' 'COUNTER';1$!$!             ***  IF DATE NOT REQUIRED, CHOP NEXT SECTION ***$!$! Get date in nice format (not needed here, but left in this time).$ TIME = F$TIME()$ DAT = F$EXTRACT(0,2,TIME)$ MON = F$EXTRACT(3,3,TIME)$ IF "''MON'" .EQS. "JAN" THEN $ MON = "January"$ IF "''MON'" .EQS. "FEB" THEN $ MON = "February"$ IF "''MON'" .EQS. "MAR" THEN $ MON = "March"$ IF "''MON'" .EQS. "APR" THEN $ MON = "April"$ IF "''MON'" .EQS. "MAY" THEN $ MON = "May"$ IF "''MON'" .EQS. "JUN" THEN $ MON = "June"$ IF "''MON'" .EQS. "JUL" THEN $ MON = "July"$ IF "''MON'" .EQS. "AUG" THEN $ MON = "August"$ IF "''MON'" .EQS. "SEP" THEN $ MON = "September"$ IF "''MON'" .EQS. "OCT" THEN $ MON = "October"$ IF "''MON'" .EQS. "NOV" THEN $ MON = "November"$ IF "''MON'" .EQS. "DEC" THEN $ MON = "December"$ YEAR = F$EXTRACT(7,4,TIME)$ TODAY = DAT + " " + MON + " " + YEAR$!$!$!*** VARY FILENAME SLIGHTLY IN CASE TWO SCRIPTS ARE RUNNING SIMULTANEOUSLY ***$!***           (Only need to vary stem of filename for each script)        ***$!$! Open temporary file for message.$ INFOFILE = "DKUSER3:[WWW]IG-REG-RR2" + "''REGNO'" + ".TXT;1"$ INFOFILE := 'F$EDIT(INFOFILE,"COLLAPSE")'$ OPEN/WRITE INFO 'INFOFILE'$ WO := WRITE INFO$ WO "       NOTE: Do NOT reply to the web server email address!"$ WO ""$ WO "************************************************"$ WO "ELECTRONIC REGISTRATION FORM for BCA-IG Low Angle Round Robin"$ WO ""$ WO "UNIQUE REGISTRATION NUMBER: # ''REGNO'"$ WO ""$ WO "Details:"$ WO ""$ WO "Title:       ''FORM_FLD_TITLE'"$ WO "First name:  ''FORM_FLD_FIRSTNAME'"$ WO "Initial(s):  ''FORM_FLD_INITIALS'"$ WO "Surname:     ''FORM_FLD_SURNAME'"$ WO "E-mail:      ''FORM_FLD_EMAIL'"$ WO ""$ WO "Postal address:"$ WO ""$ WO "Department:          ''FORM_FLD_DEPART'"$ WO "Institution:         ''FORM_FLD_INSTITUTE'"$ WO "Address (building):  ''FORM_FLD_BUILDING'"$ WO "Address (street):    ''FORM_FLD_STREET'"$ WO "Address (town):      ''FORM_FLD_TOWN'"$ WO "Address (county):    ''FORM_FLD_COUNTY'"$ WO "Address (post code): ''FORM_FLD_ZIP'"$ WO ""$ WO "Telephone:           ''FORM_FLD_PHONE'"$ WO "Facsimile:           ''FORM_FLD_FAX'"$ WO ""$ WO "************************************************"$ WO ""$ WO "                       MESSAGE"$ WO ""$ WO "Your specimen will be posted to you soon. If you have any$ WO "queries please contact:"$ WO ""$ WO "BCA-IG Webmaster"$ WO "Mr Dave Taylor"$ WO "35 Birchley Road"$ WO "Billinge"$ WO "Wigan"$ WO "Lancs"$ WO "WN5 7QJ"$ WO "United Kingdom"$ WO "E-mail: djtaylor@lineone.net"$ WO ""$ WO "       END OF ELECTRONIC REGISTRATION FORM      "$ WO "************************************************"$ WO ""$ WO "       NOTE: Do NOT reply to the web server email address!"$ WO ""$! Close temporary file.$ CLOSE/NOLOG INFO$!$!$! Email registration details to IG coordinator (Dave).$ MAIL/SUBJECT="IG-RR Registration Details" 'INFOFILE' "djt35@btopenworld.com"$!$! Email registration details to IG Chair (Jeremy).$ MAIL/SUBJECT="IG-RR Registration Details" 'INFOFILE' "cockcroft@img.bbk.ac.uk"$!$! Email registration details to A.NAME.$ ON ERROR THEN $ CONTINUE$ MAIL/SUBJECT="IG-RR Registration Details" 'INFOFILE' "''FORM_FLD_EMAIL'"$$! Delete scratch files.$ DELETE/NOLOG 'INFOFILE'$!$! Message to browser.$ WN "content-type: text/html"$ WN ""$ WN "<HTML>"$ WN "<HEAD>"$ WN "<TITLE>Registration Form for Low Angle Round Robin Completed</TITLE>"$ WN "</HEAD>"$ WN "<BODY BGCOLOR=#FFFFFF TEXT=#000000 ALINK=#FF0000 LINK=#0000FF VLINK=#AA00FF>"$ WN "<CENTER>"$ WN "<A HREF=""/bca/welcome.htm""><IMG SRC=""/bca/images/iglogo.gif"" BORDER=0></A>"$ WN "<P>"$ WN "<FONT SIZE=+2><B>Your Registration Number is ''REGNO'</B></FONT>"$ WN "<P>"$ WN "Thank you for taking the time to register electronically for the BCA"$ WN "Industrial Group low Angle Round Robin.<BR>"$ WN "You should receive an email version of your registration details"$ WN "in plain text format."$ WN "</CENTER>"$ WN "</BODY>"$ WN "</HTML>"$ EXIT$!$ 20:$ WN "content-type: text/html"$ WN ""$ WN "<HTML>"$ WN "<HEAD>"$ WN "<TITLE>Registration Form Incomplete!</TITLE>"$ WN "</HEAD>"$ WN "<BODY BGCOLOR=#FFFFFF TEXT=#000000 ALINK=#FF0000 LINK=#0000FF VLINK=#AA00FF>"$ WN "<CENTER>"$ WN "<A HREF=""/bca/welcome.htm""><IMG SRC=""/bca/images/iglogo.gif"" BORDER=0></A>"$ WN "<P><FONT SIZE=+2><B>Registration Form Incomplete!</B></FONT><P>"$ WN "Sorry, but you failed to fill in the form correctly.<P>"$ WN "Use the back button on your browser to return to the form.<P>"$ WN "Please make sure that you complete all items marked with an "$ WN "<FONT COLOR=#FF0000><B>*<B></FONT> correctly.<BR>(E-mail addesses must NOT"$ WN "contain single or double quotation marks also.)"$ WN "</CENTER>"$ WN "</BODY>"$ WN "</HTML>"$ EXIT